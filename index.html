<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bildomr√•de M√§tverktyg</title>
    <!-- Ladda Tailwind CSS fr√•n CDN f√∂r modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Importera de anpassade CSS-variablerna */
        :root {
            --background: oklch(1.0000 0 0);
            --foreground: oklch(0.1448 0 0);
            --card: oklch(1.0000 0 0);
            --card-foreground: oklch(0.1448 0 0);
            --popover: oklch(1.0000 0 0);
            --popover-foreground: oklch(0.1448 0 0);
            --primary: oklch(0.5555 0 0);
            --primary-foreground: oklch(0.9851 0 0);
            --secondary: oklch(0.9702 0 0);
            --secondary-foreground: oklch(0.2046 0 0);
            --muted: oklch(0.9702 0 0);
            --muted-foreground: oklch(0.5486 0 0);
            --accent: oklch(0.9702 0 0);
            --accent-foreground: oklch(0.2046 0 0);
            --destructive: oklch(0.5830 0.2387 28.4765);
            --destructive-foreground: oklch(0.9702 0 0);
            --border: oklch(0.9219 0 0);
            --input: oklch(0.9219 0 0);
            --ring: oklch(0.7090 0 0);
            --chart-1: oklch(0.5555 0 0);
            --chart-2: oklch(0.5555 0 0);
            --chart-3: oklch(0.5555 0 0);
            --chart-4: oklch(0.5555 0 0);
            --chart-5: oklch(0.5555 0 0);
            --sidebar: oklch(0.9851 0 0);
            --sidebar-foreground: oklch(0.1448 0 0);
            --sidebar-primary: oklch(0.2046 0 0);
            --sidebar-primary-foreground: oklch(0.9851 0 0);
            --sidebar-accent: oklch(0.9702 0 0);
            --sidebar-accent-foreground: oklch(0.2046 0 0);
            --sidebar-border: oklch(0.9219 0 0);
            --sidebar-ring: oklch(0.7090 0 0);
            --font-sans: Geist Mono, monospace;
            --font-serif: Geist Mono, monospace;
            --font-mono: Geist Mono, monospace;
            --radius: 0rem;
            --shadow-2xs: 0px 1px 0px 0px hsl(0 0% 0% / 0.00);
            --shadow-xs: 0px 1px 0px 0px hsl(0 0% 0% / 0.00);
            --shadow-sm: 0px 1px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
            --shadow: 0px 1px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
            --shadow-md: 0px 1px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
            --shadow-lg: 0px 1px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
            --shadow-xl: 0px 1px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
            --shadow-2xl: 0px 1px 0px 0px hsl(0 0% 0% / 0.00);
            --tracking-normal: 0em;
            --spacing: 0.25rem;
        }
        
        .dark {
            --background: oklch(0.1448 0 0);
            --foreground: oklch(0.9851 0 0);
            --card: oklch(0.2134 0 0);
            --card-foreground: oklch(0.9851 0 0);
            --popover: oklch(0.2686 0 0);
            --popover-foreground: oklch(0.9851 0 0);
            --primary: oklch(0.5555 0 0);
            --primary-foreground: oklch(0.9851 0 0);
            --secondary: oklch(0.2686 0 0);
            --secondary-foreground: oklch(0.9851 0 0);
            --muted: oklch(0.2686 0 0);
            --muted-foreground: oklch(0.7090 0 0);
            --accent: oklch(0.3715 0 0);
            --accent-foreground: oklch(0.9851 0 0);
            --destructive: oklch(0.7022 0.1892 22.2279);
            --destructive-foreground: oklch(0.2686 0 0);
            --border: oklch(0.3407 0 0);
            --input: oklch(0.4386 0 0);
            --ring: oklch(0.5555 0 0);
            --chart-1: oklch(0.5555 0 0);
            --chart-2: oklch(0.5555 0 0);
            --chart-3: oklch(0.5555 0 0);
            --chart-4: oklch(0.5555 0 0);
            --chart-5: oklch(0.5555 0 0);
            --sidebar: oklch(0.2046 0 0);
            --sidebar-foreground: oklch(0.9851 0 0);
            --sidebar-primary: oklch(0.9851 0 0);
            --sidebar-primary-foreground: oklch(0.2046 0 0);
            --sidebar-accent: oklch(0.2686 0 0);
            --sidebar-accent-foreground: oklch(0.9851 0 0);
            --sidebar-border: oklch(1.0000 0 0);
            --sidebar-ring: oklch(0.4386 0 0);
        }

        /* Anv√§nd de anpassade variablerna i Tailwind */
        :where(.dark) {
            --background: var(--dark-background);
            --foreground: var(--dark-foreground);
        }

        body {
            font-family: var(--font-sans);
        }
    </style>
</head>
<body class="bg-[var(--background)] text-[var(--foreground)] min-h-screen p-4 md:p-8 transition-colors duration-300">

    <div class="max-w-5xl mx-auto my-6 md:my-10 bg-[var(--card)] rounded-[var(--radius)] shadow-[var(--shadow-2xl)] overflow-hidden border border-[var(--border)]">
        
        <!-- Header-sektion -->
        <header class="bg-[var(--sidebar)] text-[var(--sidebar-foreground)] text-center p-6 md:p-8 border-b border-[var(--sidebar-border)] relative">
            <h1 class="text-3xl md:text-4xl font-extrabold mb-2">üñºÔ∏è Bildomr√•de M√§tverktyg</h1>
            <p class="text-lg text-[var(--sidebar-foreground)]/80">V√§lj en bild och dra f√∂r att m√§ta omr√•den</p>
        </header>

        <!-- Instruktioner -->
        <div class="bg-[var(--muted)] border-l-4 border-[var(--primary)] p-4 m-4 md:m-6 rounded-[var(--radius)]">
            <h4 class="text-lg font-semibold text-[var(--primary)]">üìã Instruktioner:</h4>
            <ul class="list-disc list-inside text-[var(--muted-foreground)] mt-2">
                <li>V√§lj en bildfil fr√•n din dator.</li>
                <li>Ange bildens verkliga storlek i rullgardinsmenyn.</li>
                <li>Dra med musen p√• bilden f√∂r att v√§lja ett omr√•de.</li>
                <li>**Efter att du har sl√§ppt musknappen, klicka och dra i urvalsrutan f√∂r att flytta den.**</li>
                <li>M√•tten f√∂r det valda omr√•det visas i resultaten nedan.</li>
            </ul>
        </div>

        <div class="p-4 md:p-6 bg-[var(--background)] border-b border-[var(--border)] flex flex-col md:flex-row items-center justify-between gap-4">
            
            <!-- Filuppladdningsknapp -->
            <div class="relative overflow-hidden inline-block">
                <input type="file" id="imageInput" accept="image/*" class="absolute left-[-9999px]">
                <label for="imageInput" class="file-input-label bg-[var(--primary)] text-[var(--primary-foreground)] font-bold py-3 px-6 rounded-[var(--radius)] hover:bg-[var(--primary)]/90 transition-colors duration-200 cursor-pointer shadow-[var(--shadow-md)]">
                    üìÅ V√§lj Bild
                </label>
            </div>
            
            <!-- Rullgardinsmeny f√∂r bildstorlek -->
            <select id="imageSizeSelect" class="py-3 px-4 border border-[var(--input)] rounded-[var(--radius)] bg-[var(--input)] text-[var(--foreground)] focus:outline-none focus:ring-2 focus:ring-[var(--ring)] transition-colors duration-200">
                <option value="2688x1512">2688 √ó 1512 pixels</option>
                <option value="1920x1080" selected>1920 √ó 1080 pixels</option>
                <option value="1280x720">1280 √ó 720 pixels</option>
                <option value="1024x576">1024 √ó 576 pixels</option>
            </select>

            <!-- Knapp f√∂r att v√§xla tema -->
            <button id="themeToggle" class="py-3 px-6 rounded-[var(--radius)] bg-[var(--secondary)] text-[var(--secondary-foreground)] hover:bg-[var(--secondary)]/80 transition-colors duration-200">
                Byt tema
            </button>
        </div>

        <!-- Bildcontainer med canvas och urvalsruta -->
        <div class="relative flex justify-center p-4 md:p-6 bg-[var(--muted)]">
            <canvas id="imageCanvas" class="border-2 border-[var(--border)] rounded-[var(--radius)] shadow-[var(--shadow-xl)] cursor-crosshair max-w-full h-auto"></canvas>
            <div class="selection-box absolute border-2 border-dashed border-[var(--destructive)] bg-[var(--destructive)] opacity-20 pointer-events-none hidden" id="selectionBox"></div>
        </div>

        <!-- Resultatsektion -->
        <div class="results p-6 border-t border-[var(--border)]">
            <h3 class="text-2xl font-bold text-[var(--foreground)] mb-4">üìè Resultat f√∂r valt omr√•de:</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="result-item bg-[var(--secondary)] text-[var(--secondary-foreground)] p-5 rounded-[var(--radius)] shadow-[var(--shadow-md)]">
                    <div class="text-sm opacity-90 mb-1">Bredd (Width)</div>
                    <div class="text-3xl font-extrabold" id="widthResult">-</div>
                </div>
                <div class="result-item bg-[var(--secondary)] text-[var(--secondary-foreground)] p-5 rounded-[var(--radius)] shadow-[var(--shadow-md)]">
                    <div class="text-sm opacity-90 mb-1">H√∂jd (Height)</div>
                    <div class="text-3xl font-extrabold" id="heightResult">-</div>
                </div>
                <div class="result-item bg-[var(--secondary)] text-[var(--secondary-foreground)] p-5 rounded-[var(--radius)] shadow-[var(--shadow-md)]">
                    <div class="text-sm opacity-90 mb-1">Position X</div>
                    <div class="text-3xl font-extrabold" id="xResult">-</div>
                </div>
                <div class="result-item bg-[var(--secondary)] text-[var(--secondary-foreground)] p-5 rounded-[var(--radius)] shadow-[var(--shadow-md)]">
                    <div class="text-sm opacity-90 mb-1">Position Y</div>
                    <div class="text-3xl font-extrabold" id="yResult">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ImageCropTool {
            constructor() {
                // DOM-element
                this.canvas = document.getElementById('imageCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.selectionBox = document.getElementById('selectionBox');
                this.imageInput = document.getElementById('imageInput');
                this.imageSizeSelect = document.getElementById('imageSizeSelect');
                this.themeToggle = document.getElementById('themeToggle');
                
                // Variabler f√∂r tillst√•nd
                this.image = null;
                this.isSelecting = false; // Sant n√§r en ny ruta ritas
                this.isMoving = false;    // Sant n√§r en befintlig ruta flyttas
                this.startX = 0;
                this.startY = 0;
                this.currentX = 0;
                this.currentY = 0;
                this.dragOffsetX = 0;
                this.dragOffsetY = 0;
                
                // Verklig bildstorlek (anv√§ndarens val) och skalfaktor
                this.actualImageWidth = 1920;
                this.actualImageHeight = 1080;
                this.scaleFactor = 1;
                
                this.initializeEventListeners();
            }

            // St√§ll in h√§ndelselyssnare
            initializeEventListeners() {
                this.imageInput.addEventListener('change', (e) => this.handleImageUpload(e));
                this.imageSizeSelect.addEventListener('change', (e) => this.handleSizeChange(e));
                this.themeToggle.addEventListener('click', () => this.toggleTheme());
                
                // Lyssna p√• h√§ndelser f√∂r att rita en ny ruta p√• canvasen
                this.canvas.addEventListener('mousedown', (e) => this.startSelection(e));
                this.canvas.addEventListener('mousemove', (e) => this.updateSelection(e));
                
                // Lyssna p√• h√§ndelser f√∂r att flytta den befintliga rutan
                this.selectionBox.addEventListener('mousedown', (e) => this.startMoving(e));
                
                // Lyssna p√• globala mus-upp h√§ndelser f√∂r att stoppa all interaktion
                document.addEventListener('mouseup', () => this.endInteraction());
                document.addEventListener('mousemove', (e) => this.dragSelection(e));
            }

            // Hantera uppladdning av bildfil
            handleImageUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    this.image = new Image();
                    this.image.onload = () => {
                        this.displayImage();
                        this.clearResults();
                    };
                    this.image.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            // Hantera √§ndring av den valda bildstorleken
            handleSizeChange(event) {
                const [width, height] = event.target.value.split('x').map(Number);
                this.actualImageWidth = width;
                this.actualImageHeight = height;
                this.displayImage(); // Uppdatera skalan baserat p√• den nya storleken
                this.clearResults();
            }

            // Rita ut bilden p√• canvas-elementet
            displayImage() {
                if (!this.image) return;

                // Ber√§kna visningsstorlek f√∂r canvas (begr√§nsa till maxbredd/h√∂jd)
                const maxWidth = 800;
                const maxHeight = 600;
                let displayWidth = this.image.width;
                let displayHeight = this.image.height;
                
                const widthRatio = maxWidth / displayWidth;
                const heightRatio = maxHeight / displayHeight;
                const scale = Math.min(widthRatio, heightRatio);

                displayWidth = displayWidth * scale;
                displayHeight = displayHeight * scale;

                // Uppdatera canvas-storlek och rita ut bilden
                this.canvas.width = displayWidth;
                this.canvas.height = displayHeight;
                this.ctx.drawImage(this.image, 0, 0, displayWidth, displayHeight);

                // Ber√§kna skalfaktorn f√∂r att √∂vers√§tta canvas-pixlar till anv√§ndarens verkliga pixlar
                this.scaleFactor = this.actualImageWidth / displayWidth;

                this.hideSelectionBox();
            }

            // Starta ritningen av en ny ruta
            startSelection(event) {
                if (!this.image) return;
                
                const rect = this.canvas.getBoundingClientRect();
                this.startX = event.clientX - rect.left;
                this.startY = event.clientY - rect.top;
                this.isSelecting = true;
                
                this.selectionBox.style.display = 'block';
                this.updateSelectionBox();
            }

            // Uppdatera ritningen av en ny ruta
            updateSelection(event) {
                if (!this.isSelecting || !this.image) return;
                
                const rect = this.canvas.getBoundingClientRect();
                this.currentX = event.clientX - rect.left;
                this.currentY = event.clientY - rect.top;
                
                this.updateSelectionBox();
                this.calculateAndDisplayResults();
            }

            // Starta flyttningen av en befintlig ruta
            startMoving(event) {
                if (!this.image) return;
                event.preventDefault();

                this.isMoving = true;
                const rect = this.selectionBox.getBoundingClientRect();
                this.dragOffsetX = event.clientX - rect.left;
                this.dragOffsetY = event.clientY - rect.top;

                // √Ñndra muspekaren f√∂r att visa att man kan flytta
                this.selectionBox.style.cursor = 'grabbing';
            }

            // Flytta den befintliga rutan
            dragSelection(event) {
                if (!this.isMoving || !this.image) return;
                
                const containerRect = this.canvas.parentElement.getBoundingClientRect();
                const newLeft = event.clientX - this.dragOffsetX;
                const newTop = event.clientY - this.dragOffsetY;
                
                // Begr√§nsa flyttningen till canvasens omr√•de
                const canvasRect = this.canvas.getBoundingClientRect();
                const selectionRect = this.selectionBox.getBoundingClientRect();

                let clampedLeft = Math.max(canvasRect.left, newLeft);
                clampedLeft = Math.min(clampedLeft, canvasRect.right - selectionRect.width);
                
                let clampedTop = Math.max(canvasRect.top, newTop);
                clampedTop = Math.min(clampedTop, canvasRect.bottom - selectionRect.height);

                this.selectionBox.style.left = (clampedLeft - containerRect.left) + 'px';
                this.selectionBox.style.top = (clampedTop - containerRect.top) + 'px';

                // Uppdatera start-koordinaterna f√∂r den nya positionen
                this.startX = clampedLeft - canvasRect.left;
                this.startY = clampedTop - canvasRect.top;
                this.currentX = this.startX + selectionRect.width;
                this.currentY = this.startY + selectionRect.height;

                this.calculateAndDisplayResults();
            }
            
            // Avsluta all interaktion
            endInteraction() {
                this.isSelecting = false;
                this.isMoving = false;
                this.selectionBox.style.cursor = 'move';
            }

            // Uppdatera stil och position f√∂r urvalsrutan vid ritning
            updateSelectionBox() {
                const canvasRect = this.canvas.getBoundingClientRect();
                const containerRect = this.canvas.parentElement.getBoundingClientRect();
                
                const left = Math.min(this.startX, this.currentX);
                const top = Math.min(this.startY, this.currentY);
                const width = Math.abs(this.currentX - this.startX);
                const height = Math.abs(this.currentY - this.startY);
                
                this.selectionBox.style.left = (canvasRect.left - containerRect.left + left) + 'px';
                this.selectionBox.style.top = (canvasRect.top - containerRect.top + top) + 'px';
                this.selectionBox.style.width = width + 'px';
                this.selectionBox.style.height = height + 'px';
            }

            // Ber√§kna och visa resultaten
            calculateAndDisplayResults() {
                const selectionWidth = Math.abs(this.currentX - this.startX);
                const selectionHeight = Math.abs(this.currentY - this.startY);
                const selectionX = Math.min(this.startX, this.currentX);
                const selectionY = Math.min(this.startY, this.currentY);

                // Konvertera till verkliga bildkoordinater med skalfaktorn
                const realWidth = Math.round(selectionWidth * this.scaleFactor);
                const realHeight = Math.round(selectionHeight * this.scaleFactor);
                const realX = Math.round(selectionX * this.scaleFactor);
                const realY = Math.round(selectionY * this.scaleFactor);

                document.getElementById('widthResult').textContent = realWidth + 'px';
                document.getElementById('heightResult').textContent = realHeight + 'px';
                document.getElementById('xResult').textContent = realX + 'px';
                document.getElementById('yResult').textContent = realY + 'px';
            }

            // D√∂lj urvalsrutan
            hideSelectionBox() {
                this.selectionBox.style.display = 'none';
            }

            // Rensa resultatvisningen
            clearResults() {
                document.getElementById('widthResult').textContent = '-';
                document.getElementById('heightResult').textContent = '-';
                document.getElementById('xResult').textContent = '-';
                document.getElementById('yResult').textContent = '-';
                this.hideSelectionBox();
            }

            // V√§xla mellan ljus och m√∂rk tema
            toggleTheme() {
                document.body.classList.toggle('dark');
            }
        }

        // Starta applikationen n√§r sidan laddas
        document.addEventListener('DOMContentLoaded', () => {
            new ImageCropTool();
        });
    </script>
</body>
</html>
